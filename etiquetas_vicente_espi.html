<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Etiquetas Vicente Espi</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>

<link href="css/estilos_odoo.css" rel="stylesheet"/></head>
<body>
<div class="selector no-print" id="bloque-selector">
<div class="card" onclick="abrirFormulario('rollos')">üè∑Ô∏è Etiquetas Rollos</div>
<div class="card" onclick="alert('Etiquetas Cono: pr√≥ximamente')">üßµ Etiquetas Cono</div>
<div class="card" onclick="alert('Etiquetas de la Semana: pr√≥ximamente')">üìÖ Etiquetas de la Semana</div>
</div>
<div id="bloque-rollos" style="display:none;">
<div class="formulario no-print">
<h2>Etiqueta Vicente Espi - Rollos</h2>
<input id="modelo" placeholder="Modelo"/>
<input id="lote" placeholder="Lote"/>
<input id="mezcla" placeholder="Mezcla"/>
<input id="grosor" placeholder="Grosor"/>
<input id="color" placeholder="Color"/>
<input id="maquina" placeholder="M√°quina"/>
<input id="encerado" placeholder="Encerado para"/>
<button onclick="renderPreview()" type="button">Previsualizar</button>
<button onclick="imprimir()" type="button">üñ®Ô∏è Imprimir</button>
</div>
<div class="preview-area no-print" id="previewEtiqueta"></div>
<div class="etiqueta-sheet" id="printArea"></div>
</div>
<div class="modal no-print" id="modalPrint">
<div class="modal-content">
<h3>Imprimir etiquetas</h3>
<label>Cantidad (1-14):</label>
<input id="inputCantidad" max="14" min="1" type="number" value="1"/>
<label>Posici√≥n inicial (1-14):</label>
<input id="inputPosicion" max="14" min="1" type="number" value="1"/>
<div>
<button onclick="confirmarImpresion()">Imprimir</button>
<button onclick="cerrarModal()">Cancelar</button>
</div>
</div>
</div>
<script>
    function abrirFormulario(tipo) {
      document.getElementById("bloque-selector").style.display = "none";
      if (tipo === 'rollos') {
        document.getElementById("bloque-rollos").style.display = "block";
      }
    }

    function buildEtiquetaHTML(titulo, descripcion) {
      return `
        <div class="etiqueta">
          <img src="logo-vespi-vertical-large.jpg" alt="Logo V.Espi">
          <div class="contenido">
            <div class="titulo">${titulo}</div>
            <div class="descripcion">${descripcion}</div>
          </div>
        </div>`;
    }

    function renderPreview() {
      const modelo = document.getElementById("modelo").value.trim();
      const lote = document.getElementById("lote").value.trim();
      const mezcla = document.getElementById("mezcla").value.trim();
      const grosor = document.getElementById("grosor").value.trim();
      const color = document.getElementById("color").value.trim();
      const maquina = document.getElementById("maquina").value.trim();
      const encerado = document.getElementById("encerado").value.trim();

      const titulo = modelo || "(modelo)";
      const descripcion =
        "Lote " + lote + " / " + mezcla + " / " + grosor + " /\n" +
        color + " / " + maquina + ".\n" +
        "Encerado para : " + encerado;

      const etiquetaHTML = buildEtiquetaHTML(titulo, descripcion);
      const preview = document.getElementById("previewEtiqueta");
      preview.innerHTML = etiquetaHTML;
      preview.classList.add("active");
    }

    function imprimir() {
      document.getElementById("modalPrint").style.display = "flex";
    }

    function cerrarModal() {
      document.getElementById("modalPrint").style.display = "none";
    }

    function confirmarImpresion() {
      const cantidad = parseInt(document.getElementById("inputCantidad").value);
      const posicion = parseInt(document.getElementById("inputPosicion").value);

      if (isNaN(cantidad) || cantidad < 1 || cantidad > 14 ||
          isNaN(posicion) || posicion < 1 || posicion > 14 ||
          (posicion - 1 + cantidad > 14)) {
        alert("Verifica que la cantidad y la posici√≥n inicial sean v√°lidas y no excedan el l√≠mite de 14 etiquetas.");
        return;
      }

      cerrarModal();

      const modelo = document.getElementById("modelo").value.trim();
      if (!modelo) {
        alert("Por favor, introduce al menos el MODELO antes de imprimir.");
        return;
      }

      const lote = document.getElementById("lote").value.trim();
      const mezcla = document.getElementById("mezcla").value.trim();
      const grosor = document.getElementById("grosor").value.trim();
      const color = document.getElementById("color").value.trim();
      const maquina = document.getElementById("maquina").value.trim();
      const encerado = document.getElementById("encerado").value.trim();

      const titulo = modelo;
      const descripcion =
        "Lote " + lote + " / " + mezcla + " / " + grosor + " /\n" +
        color + " / " + maquina + ".\n" +
        "Encerado para : " + encerado;

      const etiquetas = new Array(14).fill('<div class="etiqueta"></div>');
      const etiquetaHTML = buildEtiquetaHTML(titulo, descripcion);

      for (let i = 0; i < cantidad; i++) {
        etiquetas[posicion - 1 + i] = etiquetaHTML;
      }

      document.getElementById("printArea").innerHTML = etiquetas.join('');
      window.print();
    }
  </script>
</body>
</html>
