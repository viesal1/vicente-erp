<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Etiquetas - CERAPLAST</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/estilos_odoo.css">
</head>
<body>
  <div class="container">
    <h1>Gesti√≥n de Etiquetas - CERAPLAST</h1>
    <div class="actions">
      <button onclick="nuevaCarpeta()">‚ûï Nueva Carpeta</button>
    </div>
    <div id="estructura"></div>
  </div>
  <script>
    let estructura = JSON.parse(localStorage.getItem("estructura_ceraplast")) || {};

    function guardar() {
      localStorage.setItem("estructura_ceraplast", JSON.stringify(estructura));
      render();
    }

    function nuevaCarpeta(path = []) {
      const nombre = prompt("Nombre de la carpeta:");
      if (!nombre) return;
      let actual = estructura;
      for (const p of path) actual = actual[p].sub;
      actual[nombre] = { etiquetas: [], sub: {} };
      guardar();
    }

    function nuevaEtiqueta(path) {
      const nombre = prompt("Nombre de la etiqueta:");
      if (!nombre) return;
      let actual = estructura;
      for (const p of path) actual = actual[p].sub;
      actual[path[path.length - 1]].etiquetas.push(nombre);
      guardar();
    }

    function eliminarCarpeta(path) {
      if (!confirm("¬øEliminar carpeta y su contenido?")) return;
      let actual = estructura;
      for (let i = 0; i < path.length - 1; i++) actual = actual[path[i]].sub;
      delete actual[path[path.length - 1]];
      guardar();
    }

    function eliminarEtiqueta(path, i) {
      let actual = estructura;
      for (const p of path) actual = actual[p].sub;
      actual[path[path.length - 1]].etiquetas.splice(i, 1);
      guardar();
    }

    function render() {
      const cont = document.getElementById("estructura");
      cont.innerHTML = "";
      renderFolders(cont, estructura, []);
    }

    function renderFolders(elem, obj, path) {
      Object.keys(obj).forEach(function(key) {
        const p = [...path, key];
        const folder = document.createElement("div");
        folder.className = "carpeta";
        folder.innerHTML = "<span>üìÅ " + key + "</span>" +
          "<span>" +
            "<button onclick='nuevaCarpeta(" + JSON.stringify(p) + ")'>+ Sub</button>" +
            "<button onclick='nuevaEtiqueta(" + JSON.stringify(p) + ")'>+ Etiqueta</button>" +
            "<button onclick='eliminarCarpeta(" + JSON.stringify(p) + ")'>‚ùå</button>" +
          "</span>";
        elem.appendChild(folder);

        const etiquetas = obj[key].etiquetas || [];
        etiquetas.forEach(function(etiqueta, i) {
          const e = document.createElement("div");
          e.className = "etiqueta";
          e.innerHTML = "<span>üè∑Ô∏è " + etiqueta + "</span>" +
            "<button onclick='eliminarEtiqueta(" + JSON.stringify(p) + ", " + i + ")'>‚ùå</button>";
          elem.appendChild(e);
        });

        const subCont = document.createElement("div");
        subCont.style.marginLeft = "20px";
        elem.appendChild(subCont);
        renderFolders(subCont, obj[key].sub || {}, p);
      });
    }

    render();
  </script>
</body>
</html>
